<#include "/html/main.html">

    <section id="container">
       
        <!--main content start-->
        <div id="body">
        <section class="main-content-wrapper">
            <section id="main-content">
                <div class="row">
                    <div class="col-md-12">
                    
                        <h1 class="h1">用户信息</h1>
                    </div>
                </div>

                <div class="row">
<!--                     <div class="col-md-12"> -->
                    
                        <div class="panel panel-default">
<!--                             <div class="panel-heading"> -->
<!--                                 <h3 class="panel-title" style="margin-top: -86px;">Data Tables</h3> -->
<!--                                 <div class="actions pull-right"> -->
<!--                                     <i class="fa fa-chevron-down"></i> -->
<!--                                     <i class="fa fa-times"></i> -->
<!--                                 </div> -->
                                
                                
                                
<div style="padding: 100px 100px 1000px;">
<!--     <form class="bs-example bs-example-form" role="form" id="toform"> -->
        <div class="row">
        
            <br>
<!--             <div class="col-lg-6" style="left: 1213px;top: -104px;"> -->
                <div class="input-group" style="margin-right: 398px;">
                    <input type="text" class="form-control" placeholder="联系方式" id="phone" style="left: 1226px;top: -111px;">
                    
                </div><!-- /input-group -->
<!--             </div>/.col-lg-6 -->
            
<!--              <div class="col-lg-7" style="left: 752px;top: -162px;"> -->
                <div class="input-group" style="left: 76px;margin-right: 494px;">
                    <input type="text" class="form-control" placeholder="用户名称" id="name" style="left: 906px;top: -162px;">
<!--                     <span class="input-group-btn"> -->
<!--                         <button class="btn btn-default" id="name" type="button">Go!</button> -->
<!--                     </span> -->
                </div><!-- /input-group -->
<!--             </div>/.col-lg-6 -->
<!--        <button type="button" class="btn btn-primary btn-sm" onclick="mohu()" style="margin-left: 654px;margin-top: -202px;">小的原始按钮</button> -->
<!--     </form> -->
</div>
       <button type="button" class="btn btn-primary" onclick="mohu()" style="margin-left: 1131px;margin-top: -408px;width: 80px;">Go</button>
       
       <button type="button" class="btn btn-primary"  style="margin-top: -411px;margin-left: -1297px;background-color: coral;" data-toggle="modal" data-target="#myModal">新增</button>
        <button type="button" class="btn btn-primary" style="margin-top: -411px;margin-left: 12px;background-color: coral;" onclick="updateSelect()" id="rem" data-toggle="modal" data-target="#myModalup">修改</button>
         <button type="button" class="btn btn-primary"  style="margin-top: -411px;margin-left: 13px;background-color: coral;" data-toggle="modal" data-target="#myModald">删除</button>
                                
                                
                                
                            </div>
                            <div class="panel-body" style="margin-top: -1206px;">
                            <#if PageInfo.list ??> 
                            <div id="exampleTwo">
                                <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
					                                                    <th>#</th>
																	    <th>用户名</th>
																	    <th>密码</th>
																	    <th>真实姓名</th>
																	    <th>联系方式</th>
																	    <th>创建时间</th>
                                        </tr>
                                    </thead>

	                                   <tbody>
											 <#list PageInfo.list as item>
												                      <tr>
																	    <td><input type="checkbox" value="${item.userId}" name="chk_uid"></td> 
																	    <td>${item.userName}</td>
																	    <td>${item.password}</td>
																	     <td>${item.realName}</td>
																	    <td>${item.userPhone}</td>
																	    <td>${item.createTime}</td>
																	  </tr>
							                </#list>
									 </tbody>
											
                                </table>
                                
						&nbsp;&nbsp;&nbsp;&nbsp;<button type="button" onclick="top()" id="top" value="1">首页</button>
						<button type="button" id="start" onclick="start()" value="${PageInfo.pageNum}" >上一页</button>
						<button type="button" id="next" onclick="next()" value="${PageInfo.pageNum}">下一页</button>
						<button type="button" id="end" onclick="shartdom()" value="${PageInfo.pages}">末页</button>
	
						当前第[${PageInfo.pageNum}]页
						共[${PageInfo.pages}]页
						共[${PageInfo.total}]条	
                          </div>        
                        </#if>        
                            </div>
<!--                         </div> -->
                    </div>
                    
                </div>

            </section>

<ul class="pagination pagination-lg">

<!-- <ul class="pager"> -->
    
<!-- </ul> -->



        </section>
        <!--main content end-->
</div>
               
    </section>
    
    
    
    <!--Global JS-->
<!-- 新增（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					新增
				</h4>
			</div>
	<form  id="insertFrom">
			<div class="modal-body">
				   名称：<input type="text" class="form-control" placeholder="名称" name="userName" id="uname">
				   密码：<input type="text" class="form-control" placeholder="密码" name="password" id="pass">
				   真实姓名：<input type="text" class="form-control" placeholder="真实姓名" name="realName">
				   联系方式：<input type="text" class="form-control" placeholder="联系方式" name="userPhone">
			</div>
	</form>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="button" class="btn btn-primary" onclick="insertUser()">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>




<!-- 删除（Modal） -->
<!-- <!-- 按钮触发模态框 --> 
<!-- <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModald"> -->
<!-- 	开始演示模态框 -->
<!-- </button> -->
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModald" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					确认信息
				</h4>
			</div>
			
			<div class="modal-body">
				确认要删除吗???
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="button" class="btn btn-primary" onclick="shanchu()">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>



<!-- 修改 -->
<div class="modal fade" id="myModalup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					修改
				</h4>
			</div>
			<form  id="updateFrom">
				<div class="modal-body">
				           <input type="text" class="form-control" style="display:none;"  name="userId" id="userId">
					   名称：<input type="text" class="form-control" placeholder="名称" name="userName" id="unameup">
					   密码：<input type="text" class="form-control" placeholder="密码" name="password" id="passup">
					   真实姓名：<input type="text" class="form-control" placeholder="真实姓名" name="realName" id="realNameup">
					   联系方式：<input type="text" class="form-control" placeholder="联系方式" name="userPhone" id="userPhoneup">
				</div>
			</form>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="button" class="btn btn-primary" onclick="xiugai()">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
	
	    <div class="panel panel-default">  
    <div class="panel-body">  
    <table id="table_server" ></table>  
    </div>  
    </div>  
</div>

<input type=text style="display:none" id="pages" value="${PageInfo.pages}"><!-- 总页数 -->
<input type=text style="display:none" id="pageNum" value="${PageInfo.pageNum}"><!-- 当前第几页 -->


<script type="text/javascript">
//上一页
function start(){
	var userName=$("#name").val().trim();
	var userPhone=$("#phone").val().trim();
	var start = Number($("#start").val())-1;
	$.ajax({
		type:"post",
		url:"/userjson/userListJson",
		data:{'userName':userName,"userPhone":userPhone,"page":start},
		dataType:"json",
		async:false,
		success:function(msg){
			console.log(msg);
			if( msg.data.pageNum == 0){
				document.getElementById("start").disabled = true;
			}else{
				pinjie(msg);
			}
			
			
		}
     });

}

//下一页

	function next(){
		var userName=$("#name").val().trim();
		var userPhone=$("#phone").val().trim();
	 var next = Number($("#next").val())+1;
	
	$.ajax({
		type:"post",
		url:"/userjson/userListJson",
		data:{'userName':userName,"userPhone":userPhone,"page":next},
		dataType:"json",
		async:false,
		success:function(msg){
			if(msg.data.pages < msg.data.pageNum){
				document.getElementById("next").disabled = true;
			}else{
				pinjie(msg);
			}
			
			
		}
     });
	
};



//首页
function topd(){
	var userName=$("#name").val().trim();
	var userPhone=$("#phone").val().trim();
	var top = $("#top").val();
	$.ajax({
		type:"post",
		url:"/userjson/userListJson",
		data:{'userName':userName,"userPhone":userPhone,"page":top},
		dataType:"json",
		async:false,
		success:function(msg){
			console.log(msg);
			pinjie(msg);
		}
     });
};	

//末页
 function shartdom(){
		var userName=$("#name").val().trim();
		var userPhone=$("#phone").val().trim();
	var end = $("#end").val();
	$.ajax({
		type:"post",
		url:"/userjson/userListJson",
		data:{"userName":userName,"userPhone":userPhone,"page":end},
		dataType:"json",
		async:false,
		success:function(msg){
			console.log(msg);
			pinjie(msg);
		}
     });
};




//模糊查询
function mohu(){
	var userName=$("#name").val().trim();
	var userPhone=$("#phone").val().trim();
	$.ajax({
		type:"post",
		url:"/userjson/userListJson",
		data:{'userName':userName,"userPhone":userPhone},
		dataType:"json",
		async:false,
		success:function(msg){
			console.log(msg);
			pinjie(msg);
		}
     });
};



//异步刷新拼接数据
function pinjie(msg){
	var item="";
	var itemabc="";
	item +='<table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%"><thead><tr><th>#</th><th>用户名</th><th>密码</th><th>真实姓名</th><th>联系方式</th><th>创建时间</th></tr></thead><tbody>';
    $.each(msg.data.list,function(i,result){
    	item +='<tr>';
    	item +='<td><input type="checkbox" value="'+result["userId"]+'" name="chk_uid"></td>';
    	item =item+'<td>'+(result["userName"]==undefined?'':result["userName"])+'</td>';
    	item =item+'<td>'+(result["password"]==undefined?'':result["password"])+'</td>';
    	item =item+'<td>'+(result["realName"]==undefined?'':result["realName"])+'</td>';
    	item =item+'<td>'+(result["userPhone"]==undefined?'':result["userPhone"])+'</td>';
    	item =item+'<td>'+(result["createTime"]==undefined?'':result["createTime"])+'</td>';
    	item +='</tr>';
    	
    });
    var data = msg.data.pageNum;
    itemabc += '</tbody></table>';
    itemabc +=' &nbsp;&nbsp;&nbsp;&nbsp;<button type="button" onclick="topd()" id="top" value="1">首页</button>';
    itemabc += '<button type="button" id="start" onclick="start()" value="'+msg.data.pageNum+'" >上一页</button>';
    itemabc += '<button type="button" id="next" onclick="next()" value="'+msg.data.pageNum+'">下一页</button>';
    itemabc += '<button type="button" id="end" onclick="shartdom()" value="'+msg.data.pages+'">末页</button>';	
    itemabc += '当前第['+msg.data.pageNum+']页共['+msg.data.pages+']页共['+msg.data.total+']条';	
//        alert(itemabc);	
//        alert(item+itemabc);
	$("#exampleTwo").html(item+itemabc);
}

//新增 
function insertUser(){
	
	var uname=$("#uname").val();
	var pass=$("#pass").val();
	if((uname.trim() != '' && uname.trim() != null) && (pass.trim() != '' && pass.trim() != null)){

    	var formData = $("#insertFrom").serialize();
    	$.ajax({
			type:"post",
			url:"/userjson/insert",
			data:formData,
			dataType:"json",
			async:false,
			success:function(msg){
				if(msg.errcode == 0){
					pinjie(msg);
					$('#myModal').modal('hide');
					$(".form-control").val('');
					alert("新增成功");
				}else{
					alert(msg.message);
				}
			},
			error:function(msg){
				slert("服务异常!!!");
			}
	     });
	}else if(uname.trim() == '' || uname.trim() == null){
		alert("用户名不能为空!!!");
	}else if(pass.trim() == '' || pass.trim() == null){
		alert("密码不能为空!!!");
	}
	
	
}





	//删除
	function shanchu(){
	    	
	    	var fruit = new Array();
	    	var chackBox = $("input[name='chk_uid']:checked").val();
	    	if(chackBox == null || chackBox == ""){
	    		alert("请选择要删除的选项!!!");
	    		$('#myModald').modal('hide');
	    	}else{
	    		$("input:checkbox[name='chk_uid']:checked").each(function() {
	    			fruit.push($(this).val()) ;
	    		});
	//     		var fruitto = JSON.stringify(fruit);
	    		$.ajax({
	    			type:"post",
	    			url:"/userjson/deleteUser",
	    			data:{'userId':JSON.stringify(fruit)},
	    			dataType:"json",
	    			async:false,
	    			success:function(msg){
	    				if(msg.errcode == 0){
	    					alert("删除成功");
	    					$('#myModald').modal('hide');
	    					pinjie(msg);
	    				}else{
	    					alert(msg.message);
	    				}
	    			},
	    			error:function(msg){
	    				alert("服务异常!!!");
	    				$('#myModald').modal('hide');
	    			}
	    	     });
	    	}
	    };

	   
	    
//修改时回显
function updateSelect(){
// 	data-toggle="modal" data-target="#myModalup"
   	var fruit = new Array();
	var chackBox = $("input[name='chk_uid']:checked").val();
	if(chackBox == null || chackBox == ""){
		alert("请选择要修改的选项!!!");
		$('#myModalup').modal('hide');
		$("#rem").removeAttr("data-target");
		$("#rem").removeAttr("data-toggle");
		
	}else{
		$("input:checkbox[name='chk_uid']:checked").each(function() {
			fruit.push($(this).val()) ;
		});
	
	if(fruit.length > 1){
		alert("一次只能修改一个");
		$('#myModalup').modal('hide');
		$("#rem").removeAttr("data-target");
		$("#rem").removeAttr("data-toggle");
	}else{
		$("#rem").attr("data-toggle","modal");
		$("#rem").attr("data-target","#myModalup");


		$.ajax({
			type:"post",
			url:"/userjson/selectOne",
			data:{'userId':chackBox},
			dataType:"json",
			async:false,
			success:function(msg){
				if(msg.errcode == 0){
					$("#userId").val(msg.data.userId);
					$("#unameup").val(msg.data.userName);
					$("#passup").val(msg.data.password);
					$("#realNameup").val(msg.data.realName);
					$("#userPhoneup").val(msg.data.userPhone);
				}else{
					alert(msg.message);
				}
			},
			error:function(msg){
				alert("服务异常!!!");
				$('#myModalup').modal('hide');
			}
	     });
	}
}	
	
	
}


//修改
function xiugai(){
	var formData = $("#updateFrom").serialize();
	$.ajax({
		type:"post",
		url:"/userjson/updateOne",
		data:formData,
		dataType:"json",
		async:false,
		success:function(msg){
			if(msg.errcode == 0){
				alert("修改成功");
				$('#myModalup').modal('hide');
				pinjie(msg);
			}else{
				alert(msg.message);
			}
		},
		error:function(msg){
			alert("服务异常!!!");
			$('#myModalup').modal('hide');
		}
     });
	
}



// $(document).ready(function() { 
// 	var pages = $("#pages").val(); //总页数
// 	var pageNum = $("#pageNum").val();  //当前第几页
// 	var pag = '';
// 	if(pages > 5 && pages < 10){
// 		for(var i=1;i<=5;i++){
// 			pag += '<li><a href="#">'+i+'</a></li>';
// 		}
// 	}
// 	$(".pager").append("<li><a href='#' onclick='top()' id='top' value='1'>&laquo;</a></li>"+pag+".....<li><a href='#'>&raquo;</a></li>");
	
// });

// <li><a href="#" onclick="top()" id="top" value="1">&laquo;</a></li>
// <li class="disabled"><a href="#">1</a></li>
// <li><a href="#">2</a></li>
// <li><a href="#">3</a></li>
// <li><a href="#">4</a></li>
// <li><a href="#">5</a></li>
// <li><a href="#">&raquo;</a></li>
</script>  




